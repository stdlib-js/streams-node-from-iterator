// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-iterator-like@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-error@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-buffer@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-inherit@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-property@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/buffer-from-string@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/buffer-ctor@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-next-tick@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";function g(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})})),t}var j="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function v(){throw new Error("setTimeout has not been defined")}function w(){throw new Error("clearTimeout has not been defined")}var y=v,_=w;function x(e){if(y===setTimeout)return setTimeout(e,0);if((y===v||!y)&&setTimeout)return y=setTimeout,setTimeout(e,0);try{return y(e,0)}catch(t){try{return y.call(null,e,0)}catch(t){return y.call(this,e,0)}}}"function"==typeof j.setTimeout&&(y=setTimeout),"function"==typeof j.clearTimeout&&(_=clearTimeout);var T,M=[],E=!1,O=-1;function z(){E&&T&&(E=!1,T.length?M=T.concat(M):O=-1,M.length&&k())}function k(){if(!E){var e=x(z);E=!0;for(var t=M.length;t;){for(T=M,M=[];++O<t;)T&&T[O].run();O=-1,t=M.length}T=null,E=!1,function(e){if(_===clearTimeout)return clearTimeout(e);if((_===w||!_)&&clearTimeout)return _=clearTimeout,clearTimeout(e);try{_(e)}catch(t){try{return _.call(null,e)}catch(t){return _.call(this,e)}}}(e)}}function S(e,t){this.fun=e,this.array=t}S.prototype.run=function(){this.fun.apply(null,this.array)};function N(){}var P=N,W=N,q=N,D=N,R=N,V=N,A=N;var J=j.performance||{},L=J.now||J.mozNow||J.msNow||J.oNow||J.webkitNow||function(){return(new Date).getTime()};var B=new Date;var C={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];M.push(new S(e,t)),1!==M.length||E||x(k)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:P,addListener:W,once:q,off:D,removeListener:R,removeAllListeners:V,emit:A,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*L.call(J),r=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(r-=e[0],(i-=e[1])<0&&(r--,i+=1e9)),[r,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-B)/1e3}},F=require("stream");"disable"===C.env.READABLE_STREAM&&F?(module.exports=F,exports=module.exports=F.Readable,exports.Readable=F.Readable,exports.Writable=F.Writable,exports.Duplex=F.Duplex,exports.Transform=F.Transform,exports.PassThrough=F.PassThrough,exports.Stream=F):(exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=F||exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js"));var I=g(Object.freeze({__proto__:null})),G={objectMode:!1,encoding:null,sep:"\n"},H=p,K=t,Q=h.isPrimitive,U=f.isPrimitive,X=c.isPrimitive,Y=b,Z=m;var $=function(e,t){return H(t)?K(t,"sep")&&(e.sep=t.sep,!X(e.sep))?new TypeError(Z("invalid option. `%s` option must be a string. Option: `%s`.","sep",e.sep)):K(t,"objectMode")&&(e.objectMode=t.objectMode,!Q(e.objectMode))?new TypeError(Z("invalid option. `%s` option must be a boolean. Option: `%s`.","objectMode",e.objectMode)):K(t,"encoding")&&(e.encoding=t.encoding,!X(e.encoding)&&null!==e.encoding)?new TypeError(Z("invalid option. `%s` option must be a string or null. Option: `%s`.","encoding",e.encoding)):K(t,"highWaterMark")&&(e.highWaterMark=t.highWaterMark,!U(e.highWaterMark))?new TypeError(Z("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","highWaterMark",e.highWaterMark)):K(t,"serialize")&&(e.serialize=t.serialize,!Y(e.serialize))?new TypeError(Z("invalid option. `%s` option must be a function. Option: `%s`.","serialize",e.serialize)):null:new TypeError(Z("invalid argument. Options argument must be an object. Value: `%s`.",t))};module.exports=void 0!==C&&"renderer"===C.type?require("./browser.js"):require("./node.js");var ee=g(Object.freeze({__proto__:null}))("from-iterator-stream"),te=I.Readable,re=t,ie=r,se=i,ne=s,oe=n,ae=a,le=e,ue=l,de=u,me=d,pe=m,he=G,fe=$,ce=ee;function be(e,t){var r,i;if(!(this instanceof be))return arguments.length>1?new be(e,t):new be(e);if(!ie(e))throw new TypeError(pe("invalid argument. First argument must be an iterator. Value: `%s`.",e));if(r=oe(he),arguments.length>1&&(i=fe(r,t)))throw i;return ce("Creating a readable stream configured with the following options: %s.",JSON.stringify(r)),te.call(this,r),ae(this,"_destroyed",!1),le(this,"_objectMode",r.objectMode),le(this,"_sep",r.sep),le(this,"_serialize",r.serialize||JSON.stringify),le(this,"_iterator",e),ae(this,"_i",0),this}o(be,te),le(be.prototype,"_read",(function(){var e,t,r;if(!this._destroyed)for(e=!0;e;){if(r=this._iterator.next(),this._i+=1,r.done)return re(r,"value")&&(r=r.value,ce("Value: %s. Iter: %d.",JSON.stringify(r),this._i),!1===this._objectMode&&("string"==typeof(r=this._serialize(r))?(r=1===this._i?ue(r):ue(this._sep+r),this.push(r)):ne(r)?(this._i>1&&(r=de.concat([ue(this._sep),r])),this.push(r)):(t=new Error(pe("invalid operation. Serialization function must return a string or Buffer. Value: `%s`.",r)),this.emit("error",t)))),ce("Finished iteration."),this.push(null);if(r=r.value,ce("Value: %s. Iter: %d.",JSON.stringify(r),this._i),!1===this._objectMode)if("string"==typeof(r=this._serialize(r)))r=1===this._i?ue(r):ue(this._sep+r);else{if(!ne(r)){t=new Error(pe("invalid operation. Serialization function must return a string or Buffer. Value: `%s`.",r)),this.emit("error",t);continue}this._i>1&&(r=de.concat([ue(this._sep),r]))}e=this.push(r)}})),le(be.prototype,"destroy",(function(e){var t;return this._destroyed?(ce("Attempted to destroy an already destroyed stream."),this):(t=this,this._destroyed=!0,me((function(){e&&(ce("Stream was destroyed due to an error. Error: %s.",se(e)?e.message:JSON.stringify(e)),t.emit("error",e));ce("Closing the stream..."),t.emit("close")})),this)}));var ge=p,je=m,ve=n,we=be;var ye=n,_e=be;var xe=e,Te=be,Me=function(e,t){var r;if(arguments.length>1){if(!ge(r=t))throw new TypeError(je("invalid argument. Options argument must be an object. Value: `%s`.",r));r=ve(t,1)}else r={};return r.objectMode=!0,new we(e,r)},Ee=function(e){var t;return t=arguments.length?ye(e,1):{},r;function r(e){return new _e(e,t)}};xe(Te,"objectMode",Me),xe(Te,"factory",Ee);var Oe=Te;export{Oe as default,Ee as factory,Me as objectMode};
//# sourceMappingURL=index.mjs.map
